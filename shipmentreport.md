# Shipment Profitability Report - Implementation Plan

## Overview
The goal is to provide the business owner with a clear financial report per shipment (cargo). Since the business operates on a "bidding/surplus" model, the cost is incurred at the shipment level (total investment), while revenue is generated by selling individual items found within that shipment.

**Key Formula:**
`Profit = (Total Revenue from Sold Items linked to Shipment) - (Total Shipment Cost)`

---

## Phase 1: Database Modification

**Objective:** Store the total investment cost for each shipment.

1.  **Modify `shipments` Table:**
    *   Add a new column `cost` (DECIMAL 10,2).
    *   Default value should be `0.00`.
    *   *Rationale:* This represents the bidding price + delivery fees paid by the owner.

2.  **Update Database Scripts:**
    *   Update `scripts/tialo_posdb.sql` to reflect this schema change for future deployments.

---

## Phase 2: Backend Logic & Data Handling

**Objective:** Calculate the financials dynamically.

1.  **Update Shipment Model/Queries:**
    *   Update `process_shipment.php` (or equivalent) to handle the input of the `cost` field when creating or editing a shipment.

2.  **Report Calculation Logic:**
    *   Create a query to fetch shipment details.
    *   Create a query to calculate **Total Revenue** for a specific `shipment_id`.
        *   *Method:* Join `transaction_items` with `products`.
        *   *Filter:* Where `products.shipment_id` matches the target shipment.
        *   *Sum:* Sum the `subtotal` from `transaction_items` (this ensures we calculate based on what was actually sold, not just the tag price).
    *   Create a query to count inventory stats per shipment (e.g., "50 items total, 30 sold, 20 remaining").

---

## Phase 3: Frontend Implementation (UI)

**Objective:** Visualize the data for the user.

1.  **Update Shipment Entry Form:**
    *   Modify the "Add/Edit Shipment" modal or page to include an input field for **"Total Cost / Investment"**.

2.  **Create Main Reports Page (`modules/reports/shipment_report.php`):**
    *   Display a table of all shipments.
    *   Columns: Shipment Date, Supplier, Total Cost, Total Revenue, Current Profit, Status.

3.  **Create Detailed View:**
    *   Allow the user to click a specific shipment to see:
        *   **Financial Card:** Big bold numbers for Cost, Revenue, and Profit.
        *   **Item Breakdown:** A list of all products in this shipment.
            *   Columns: Product Name, Status (Available/Sold), Sold Price (if sold).

---

## Phase 4: Testing & Verification

1.  **Data Verification:**
    *   Create a test shipment with a cost of 10,000.
    *   Add items to it.
    *   Sell a few items via the POS.
    *   Verify the report shows the correct revenue and remaining balance.

2.  **Edge Cases:**
    *   Test with a shipment that has 0 cost.
    *   Test with a shipment that has 0 sales (should show negative profit equal to cost).
